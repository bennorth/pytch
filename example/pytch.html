<html>
  <head>
    <script src="../dist/skulpt.min.js" type="text/javascript"></script>
    <script src="../dist/skulpt-stdlib.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>
  </head>

  <body>
    <canvas id="pytch-canvas" width="480" height="360" style="background-color:green"></canvas>
<textarea id="code" rows="24" cols="80">
import pytch

class Waffler:
    def __init__(self):
        self.tag = "BN"

    @pytch.when_green_flag_clicked
    def say_hello(self):
        print "[%s] in say_hello(): hello, world" % self.tag
        br = pytch.broadcast_and_wait("greet")
        print "[%s] say_hello(): back from bcast/wait; it gave %s" % (self.tag, br)

    @pytch.when_I_receive("greet")
    def greet(self):
        for i in range(1, 6):
            print "[%s] in message-handler for 'greet': greeting number %d!" % (self.tag, i)
            yr = pytch._yield_until_next_frame()
            print "[%s] greet(): back from yield-until-next-frame; it gave %s" % (self.tag, yr)

    @pytch.when_I_receive("greet")
    def greet_just_once(self):
        print "[%d] greet_just_once(): a single greeting" % self.tag

    @pytch.when_green_flag_clicked
    def keep_saying_hi(self):
        i = 0
        while i < 60:
            i += 1
            if (i % 10) == 0:
                print "[%s] hi %d" % (self.tag, i / 10)
            yr = pytch._yield_until_next_frame()
            print "[%s] back from yield-until-next-frame; it gave %s" % (self.tag, yr)

pytch.register_sprite_class(Waffler)
print "run returned: %s" % (pytch.run())
</textarea>
<div id="green-flag" style="height: 32px; width: 48px; background-color: green; margin: 16px;"></div>
<p id="frame-idx"></p>
<pre id="skulpt-stdout"></pre>
    <script>
      function append_stdout(text) {
          var elt = document.getElementById("skulpt-stdout");
          elt.innerHTML = elt.innerHTML + text;
      }

      var prog = document.getElementById("code").value;
      function builtinRead(x) {
          if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
	      throw "File not found: '" + x + "'";
          return Sk.builtinFiles["files"][x];
      }

      Sk.configure({ read: builtinRead, output: append_stdout });

      var p = Sk.misceval.asyncToPromise(function() {
          return Sk.importMainWithBody("<stdin>",false,prog,true);
      });
    </script>
  </body>
</html>
